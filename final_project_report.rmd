---
title: "Final Project Report"
author: "Yiwei Shi"
date: "`r Sys.Date()`"
output: html_document
params:
  production: TRUE
  cutpoint: 1
---
```{r, set-chunk-opts, echo = FALSE, warning = FALSE, message = FALSE, eval = params$production}
library(knitr)
library(dplyr)
library(kableExtra)
library(ggplot2)

opts_chunk$set(
  echo = FALSE, warning = FALSE, message = FALSE
)
```

## Introduction
This dataset includes data on adult's diet, physical activity, and weight status from Behavioral Risk Factor Surveillance System of all states in the US from 2011 to 2022. The dataset is in long format and also includes different stratification of Race/Ethnicity, Education, Income, Age (years) and Gender.  I will use the dataset to investigate the relationship of obesity rate and overweight rate with other behavioral factors. Also, I will use the stratified data to explore the geographical, demoghraphical and sociological influence to obesity and obesity rate. The R Markdown report may include data process, EDA, ANOVA test and regression model.

## Data Process
```{r, load_data}
data_url <- "H:/史祎苇/研究生课程/24Spring/DATA 550/Final Project/US_Nutrition_Data.csv"

data <- read.csv(data_url, header = TRUE)
```

### Unique Stratification Categories
```{r unique_stratification}
# Removing rows where Data_Value is NA
df_clean <- data[!is.na(data$Data_Value), ]

# Check how many kinds of stratification are in this dataset
unique_stratification <- unique(df_clean$StratificationCategory1)
unique_stratification
```

### Unique Variables
```{r unique_question}
# Check how many specific questions are there in the dataset
unique_questions <- unique(df_clean$Question)
unique_questions
```
```{r split_data}
# Splitting the dataset based on the unique values of StratificationCategory1
sub_datasets <- split(df_clean, df_clean$StratificationCategory1)

# Resetting the "index" (row names) for each subset
sub_datasets <- lapply(sub_datasets, function(subset) {
  row.names(subset) <- NULL
  return(subset)
})

df_age_subset <- sub_datasets[['Age']]
df_education_subset <- sub_datasets[['Education']]
df_gender_subset <- sub_datasets[['Gender']]
df_income_subset <- sub_datasets[['Income']]
df_race_subset <- sub_datasets[['Ethnicity']]
df_total_subset <- sub_datasets[['Total']]
```

## Summary Tables
### Overall Summary Table
```{r summary_table_year}
summary_df <- df_total_subset %>%
  group_by(Question) %>%
  summarise(
    Mean = mean(Data_Value, na.rm = TRUE),
    Median = median(Data_Value, na.rm = TRUE),
    Min = min(Data_Value, na.rm = TRUE),
    Max = max(Data_Value, na.rm = TRUE),
    .groups = 'drop'  # Drop the grouping
  )

# Format the summary table with kable
kable(summary_df, format = "html", caption = "Summary statistics for total data") %>%
  kable_styling("striped", full_width = F)
```

\n
The table reveals that the average prevalence of overweight and obesity in the adult population is approximately 35% and 30% respectively, indicative of a significant public health concern. Interestingly, a higher average participation rate is observed in moderate to vigorous physical activity (around 51%), yet only about 21% combine this with muscle-strengthening activities, suggesting an area for potential improvement in public health promotion.

The data further suggests disparities in lifestyle choices, such as a considerable portion of adults not engaging in any leisure-time physical activity, averaging nearly 25%. On the nutritional front, the statistics point out that less than once daily, around 39% of adults fall short of the recommended fruit intake, while approximately 20% report insufficient vegetable consumption. 
\n

### Summary Table stratified by age group
```{r summary_table_age_group, echo=FALSE, results='asis'}
for (question in unique_questions) {
  cat("Summary for: ", question, "<br>")
  
  # Filter data for the current question
  df_filtered <- df_age_subset %>% filter(Question == question)
  
  # Summarize the data
  summary_table <- df_filtered %>%
    group_by(Stratification1) %>%
    summarise(
      Mean = mean(Data_Value, na.rm = TRUE),
      Median = median(Data_Value, na.rm = TRUE),
      Min = min(Data_Value, na.rm = TRUE),
      Max = max(Data_Value, na.rm = TRUE),
      N = n(),
      .groups = 'drop'
    ) %>%
    # Rename Stratification1 to Age Group
    rename(`Age Group` = Stratification1)
  
  # Format and print the summary table with kable for the current question
  print(kable(summary_table, format = "html") %>%
    kable_styling(bootstrap_options = c("striped", "hover"), full_width = F, position = "left") %>%
    column_spec(1, width = "2cm") %>%
    column_spec(2, width = "2cm") %>%
    column_spec(3, width = "2cm") %>%
    column_spec(4, width = "2cm") %>%
    column_spec(5, width = "2cm") %>%
    column_spec(6, width = "1cm"))
  
  cat("<br><br>")
}
```
\n
From the data, it's evident that there are variations in health behaviors across different age groups. For instance, younger adults (18-24) report higher mean values for engaging in no leisure-time physical activity, suggesting a potential area for public health engagement. Obesity rates appear higher in the middle age groups (25-54), whereas older adults (65 or older) show a significant participation in physical activity, both in terms of moderate to vigorous aerobic activity and muscle-strengthening exercises.

Dietary habits also display diversity; a higher percentage of younger adults report consuming fruit less than once daily, while vegetable consumption is reported to be less frequent across all age groups, with a slight decrease as age increases. 
\n

### Summary Table stratified by income
to be added

## Distibution Plots
### Overall Distribution by Year
```{r distribution_plot_year}
for (question in unique_questions) {
  # Filter the dataset for the current question
  df_filtered <- df_total_subset %>% filter(Question == question)
  df_filtered$YearEnd <- factor(df_filtered$YearEnd)
  
  # Create the box plot for the filtered dataset
  p <- ggplot(df_filtered, aes(x = YearEnd, y = Data_Value, fill = YearEnd)) +
    geom_boxplot() +
    labs(title = paste("Boxplot for: ", question),
         x = "YearEnd",
         y = "Data Value") +
    scale_fill_discrete(name = "Year") +  # Legend title
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1), plot.title = element_text(size = 10))

  # Print the plot
  print(p)
}
```

\n
The first plot delves into the "Percent of adults who engage in no leisure-time physical activity." It exhibits a range of values for each year with median values consistently around the 30% mark, indicating that a significant portion of the adult population remains inactive during leisure time. The spread of the data, illustrated by the interquartile range (IQR), suggests that while there is some yearly fluctuation, the central tendency has remained fairly stable over the years. Outliers are present, indicating years where particular extremes were noted in inactivity rates.

The second plot addresses "Percent of adults aged 18 years and older who have obesity." This plot shows a gradual increase in median values over the years, highlighting a concerning trend in rising obesity rates. The IQRs remain relatively consistent, suggesting that while the median is shifting, the overall distribution of data around the median has not seen dramatic changes. This could indicate that while more adults are falling into the obese category, the overall variability in the population's BMI has not significantly widened.

The third plot, focusing on "Percent of adults aged 18 years and older who have an overweight classification," mirrors the trend of the obesity plot but with median values consistently higher. This implies a larger proportion of the population falls into the overweight category compared to those categorized as obese.

Lastly, the plots examining "Percent of adults who achieve at least 300 minutes a week of moderate-intensity aerobic physical activity" and "Percent of adults who report consuming fruit less than one time daily" reflect specific lifestyle choices that are critical to public health. Notably, the physical activity plot shows a wide variation in the data across different years, indicating inconsistency in physical activity levels among adults. The fruit consumption plot, albeit based on fewer years, suggests a slightly decreasing trend in daily fruit intake, with the median percentage hovering around 40%.
\n

### Distribution stratified by age group
```{r distribution_plot_for_age}
for (question in unique_questions) {
  # Filter the dataset for the current question
  df_filtered <- df_age_subset %>% filter(Question == question)
  
   # Create the plot with a smaller title font
  p <- ggplot(df_filtered, aes(x = Data_Value, fill = Stratification1)) +
    geom_density(alpha = 0.5) +  # Using density plot, adjust transparency with alpha
    labs(title = paste("Distribution for :", question),
         x = "Data Value",
         y = "Density") +
    theme_minimal() +  # Clean theme
    scale_fill_discrete(name = "Age Group") +  # Legend title
    theme(axis.text.x = element_text(angle = 45, hjust = 1),  # Improve x-axis label readability
          plot.title = element_text(size = 10))  # Set title font size smaller
  
  # Print the plot
  print(p)
}
```

### Distribution stratified by income
```{r distribution_plot_for_income}
for (question in unique_questions) {
  # Filter the dataset for the current question
  df_filtered <- df_income_subset %>% filter(Question == question)
  
   # Create the plot with a smaller title font
  p <- ggplot(df_filtered, aes(x = Data_Value, fill = Stratification1)) +
    geom_density(alpha = 0.5) +  # Using density plot, adjust transparency with alpha
    labs(title = paste("Distribution for :", question),
         x = "Data Value",
         y = "Density") +
    theme_minimal() +  # Clean theme
    scale_fill_discrete(name = "Income") +  # Legend title
    theme(axis.text.x = element_text(angle = 45, hjust = 1),  # Improve x-axis label readability
          plot.title = element_text(size = 10))  # Set title font size smaller
  
  # Print the plot
  print(p)
}
```

## ANOVA

to be done

## Regression

to be done
